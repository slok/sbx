### Task 7: Firecracker Restart Support

**Goal:** Enable `sbx start` for stopped Firecracker sandboxes.

**Context:** Firecracker VMs cannot be restarted — once the process exits, it's gone. This is a known Firecracker limitation. To support `sbx start` on stopped sandboxes, we recreate the VM transparently while preserving state.

**What the user sees:**

```bash
sbx create -f sandbox.yaml   # VM running
sbx exec my-sandbox -- touch /root/myfile
sbx stop my-sandbox          # VM stopped
sbx start my-sandbox         # VM running again
sbx exec my-sandbox -- ls /root/myfile  # File still exists!
```

User doesn't know it's a new Firecracker process — disk state and network config persist.

**What happens under the hood:**

On `stop`:
- Shutdown VM gracefully (or kill process)
- Keep: rootfs, TAP device, iptables rules, sandbox ID, IP assignment
- Update status to `stopped`

On `start`:
- Spawn new Firecracker process
- Configure VM (same kernel, same rootfs, same network)
- Boot VM
- Update PID/socket in database
- Update status to `running`

**Preserved across stop/start:**

| Resource | Preserved? |
|----------|------------|
| Rootfs (disk) | ✓ Yes — changes persist |
| TAP device | ✓ Yes — reuse same device |
| IP address | ✓ Yes — same internal IP |
| iptables rules | ✓ Yes — already configured |
| Sandbox ID | ✓ Yes — same database record |
| PID | ✗ No — new process |
| Socket | ✗ No — new socket file |

**Task system for start:**

| Operation | Tasks |
|-----------|-------|
| start | spawn_firecracker, configure_vm, boot_vm, wait_ssh |

No TAP/iptables tasks — those resources already exist from `create`.

**Validation:**

Before `start`:
- Sandbox must exist
- Status must be `stopped`
- Rootfs file must exist
- TAP device must exist (if not, fail or recreate?)

**Edge cases:**

1. **TAP device missing** (e.g., system reboot):
   - Option A: Fail with clear error, tell user to `rm` and `create` again
   - Option B: Recreate TAP + iptables automatically
   - Recommendation: Option A for now, simpler

2. **Rootfs corrupted/missing**:
   - Fail with error, sandbox needs to be recreated

3. **Start on already running**:
   - Error: "sandbox is already running"

**Tests required:**

- Stop then start preserves disk state
- New PID after start
- Same IP after start
- Start on stopped works
- Start on running fails
- Start with missing TAP fails gracefully

**Out of scope:**

- Firecracker snapshots (true pause/resume)
- Auto-recreating TAP if missing