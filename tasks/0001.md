# SBX - Task 1: Foundation

**Goal:** Build the foundation for `sbx`, a CLI tool for creating microVM sandboxes.

---

## What is SBX

SBX creates isolated microVM sandboxes for agentic coding workflows. It provides:

- Declarative sandbox definition via YAML
- Pluggable sandbox engines (Firecracker, fake for testing)
- Pluggable storage backends (SQLite, memory for testing)
- CLI for sandbox lifecycle management

---

## This Task

Create the core structure with pluggable interfaces. Use fake/mock implementations — real Firecracker integration comes later.

### Deliver

1. Sandbox engine interface + fake implementation
2. Storage interface + memory and SQLite implementations  
3. Domain models (Sandbox, SandboxConfig)
4. YAML config parsing
5. CLI `create` command only

---

## Interfaces

### Sandbox Engine

Manages sandbox lifecycle. Fake implementation simulates behavior without real VMs.

- `Create(cfg) -> Sandbox`
- `Start(id)`
- `Stop(id)`
- `Remove(id)`
- `Status(id) -> Sandbox`

### Storage

Persists sandbox state. SQLite is the production backend, memory for testing.

- `CreateSandbox(s)`
- `GetSandbox(id) -> Sandbox`
- `GetSandboxByName(name) -> Sandbox`
- `ListSandboxes() -> []Sandbox`
- `UpdateSandbox(s)`
- `DeleteSandbox(id)`

---

## Models

### Sandbox

| Field | Type | Notes |
|-------|------|-------|
| ID | string | UUID |
| Name | string | Unique, from config or override |
| Status | enum | pending, running, stopped, failed |
| Config | SandboxConfig | Original config |
| CreatedAt | time | |
| StartedAt | time | nullable |
| StoppedAt | time | nullable |
| Error | string | Last error message |

### SandboxConfig (from YAML)

| Field | Type |
|-------|------|
| Name | string |
| Base | string (e.g., "ubuntu-22.04") |
| Packages | []string |
| Env | map[string]string |
| Resources.VCPUs | int |
| Resources.MemoryMB | int |
| Resources.DiskGB | int |

---

## CLI

Only `create` for this task:

```bash
sbx create -f sandbox.yaml
sbx create -f sandbox.yaml --name override-name
```

---

## Example YAML

```yaml
name: my-sandbox
base: ubuntu-22.04
packages:
  - git
  - curl
env:
  EDITOR: vim
resources:
  vcpus: 2
  memory_mb: 2048
  disk_gb: 10
```

---

## Storage Location

SQLite database: `~/.sbx/sbx.db`

---

## Tests

- Config parsing from YAML
- Fake engine lifecycle (create → status → stop → remove)
- Memory storage CRUD
- SQLite storage CRUD
- CLI create command (integration with fake engine + memory storage)

---

## Out of Scope

- Real Firecracker integration
- Networking / port forwarding
- File sync / copy
- Remote hosts / Lima
- Bundles
- Other CLI commands (list, stop, rm, etc.)

These come in later tasks.
