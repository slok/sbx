### Task 10: Rootfs Resize

**Goal:** Automatically resize rootfs to configured `disk_gb` during sandbox creation.

**Context:** Base images are minimal (~300MB). Users need more space to install packages, store data. The `disk_gb` config option should actually result in a larger disk. Resize happens in two steps: extend the file (host), expand the filesystem (guest).

**Deliver:**

1. Extend rootfs file after copying base image
2. Expand filesystem inside VM after boot
3. Use `resources.disk_gb` from config (default: 10GB)

**Updated create task flow:**

| Sequence | Task | Description |
|----------|------|-------------|
| 1 | copy_rootfs | Copy base image to VM directory |
| 2 | resize_rootfs | Truncate file to `disk_gb` size |
| 3 | create_tap | Create TAP device |
| 4 | setup_iptables | Configure NAT rules |
| 5 | spawn_firecracker | Start Firecracker process |
| 6 | configure_vm | Configure VM via API |
| 7 | boot_vm | Start the VM |
| 8 | expand_filesystem | Run resize2fs inside VM |

**Step: resize_rootfs (host side)**

```bash
truncate -s <disk_gb>G ~/.sbx/vms/<id>/rootfs.ext4
```

- No root needed
- Fast (just extends sparse file)
- Done before VM boot

**Step: expand_filesystem (guest side)**

After VM boots and SSH is available:

```bash
ssh root@<vm-ip> "resize2fs /dev/vda"
```

- Runs as root inside guest (not host root)
- Expands filesystem to fill available space
- Must happen after boot

**Config:**

```yaml
name: my-sandbox
engine:
  firecracker:
    kernel: ~/.sbx/images/vmlinux
    rootfs: ~/.sbx/images/ubuntu-22.04.ext4
resources:
  vcpus: 2
  memory_mb: 2048
  disk_gb: 10  # â† Rootfs will be resized to 10GB
```

**Defaults:**

- If `disk_gb` not specified: default to 10GB
- Minimum: base image size (don't shrink)
- Maximum: reasonable limit? (100GB?)

**Validation:**

- `disk_gb` must be >= base image size
- Warn if very large (>50GB?)

**Tests required:**

- Rootfs file is correct size after create
- Filesystem inside VM shows correct size (`df -h`)
- Default disk_gb applied when not specified
- Error if disk_gb < base image size

**Out of scope:**

- Shrinking rootfs
- Dynamic resize while running
- Docker engine (doesn't apply)